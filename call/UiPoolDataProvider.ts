import { ethers } from "ethers";
import { AcalaJsonRpcProvider } from '@acala-network/eth-providers';
import { UserAddress } from "../utils/type";


const abi = [{"type":"constructor","stateMutability":"nonpayable","inputs":[{"type":"address","name":"_networkBaseTokenPriceInUsdProxyAggregatorAdapter","internalType":"contract IPriceAggregatorAdapter"},{"type":"address","name":"_baseTokenAddress","internalType":"address"}]},{"type":"function","stateMutability":"view","outputs":[{"type":"uint256","name":"","internalType":"uint256"}],"name":"ETH_CURRENCY_UNIT","inputs":[]},{"type":"function","stateMutability":"view","outputs":[{"type":"address","name":"","internalType":"address"}],"name":"baseTokenAddress","inputs":[]},{"type":"function","stateMutability":"pure","outputs":[{"type":"string","name":"","internalType":"string"}],"name":"bytes32ToString","inputs":[{"type":"bytes32","name":"_bytes32","internalType":"bytes32"}]},{"type":"function","stateMutability":"view","outputs":[{"type":"tuple[]","name":"","internalType":"struct IUiPoolDataProviderV2.AggregatedReserveData[]","components":[{"type":"address","name":"underlyingAsset","internalType":"address"},{"type":"string","name":"name","internalType":"string"},{"type":"string","name":"symbol","internalType":"string"},{"type":"uint256","name":"decimals","internalType":"uint256"},{"type":"uint256","name":"baseLTVasCollateral","internalType":"uint256"},{"type":"uint256","name":"reserveLiquidationThreshold","internalType":"uint256"},{"type":"uint256","name":"reserveLiquidationBonus","internalType":"uint256"},{"type":"uint256","name":"reserveFactor","internalType":"uint256"},{"type":"bool","name":"usageAsCollateralEnabled","internalType":"bool"},{"type":"bool","name":"borrowingEnabled","internalType":"bool"},{"type":"bool","name":"stableBorrowRateEnabled","internalType":"bool"},{"type":"bool","name":"isActive","internalType":"bool"},{"type":"bool","name":"isFrozen","internalType":"bool"},{"type":"uint128","name":"liquidityIndex","internalType":"uint128"},{"type":"uint128","name":"variableBorrowIndex","internalType":"uint128"},{"type":"uint128","name":"liquidityRate","internalType":"uint128"},{"type":"uint128","name":"variableBorrowRate","internalType":"uint128"},{"type":"uint128","name":"stableBorrowRate","internalType":"uint128"},{"type":"uint40","name":"lastUpdateTimestamp","internalType":"uint40"},{"type":"address","name":"lTokenAddress","internalType":"address"},{"type":"address","name":"stableDebtTokenAddress","internalType":"address"},{"type":"address","name":"variableDebtTokenAddress","internalType":"address"},{"type":"address","name":"interestRateStrategyAddress","internalType":"address"},{"type":"uint256","name":"availableLiquidity","internalType":"uint256"},{"type":"uint256","name":"totalPrincipalStableDebt","internalType":"uint256"},{"type":"uint256","name":"averageStableRate","internalType":"uint256"},{"type":"uint256","name":"stableDebtLastUpdateTimestamp","internalType":"uint256"},{"type":"uint256","name":"totalScaledVariableDebt","internalType":"uint256"},{"type":"uint256","name":"priceInMarketReferenceCurrency","internalType":"uint256"},{"type":"uint256","name":"variableRateSlope1","internalType":"uint256"},{"type":"uint256","name":"variableRateSlope2","internalType":"uint256"},{"type":"uint256","name":"stableRateSlope1","internalType":"uint256"},{"type":"uint256","name":"stableRateSlope2","internalType":"uint256"}]},{"type":"tuple","name":"","internalType":"struct IUiPoolDataProviderV2.BaseCurrencyInfo","components":[{"type":"uint256","name":"marketReferenceCurrencyUnit","internalType":"uint256"},{"type":"int256","name":"marketReferenceCurrencyPriceInUsd","internalType":"int256"},{"type":"int256","name":"networkBaseTokenPriceInUsd","internalType":"int256"},{"type":"uint8","name":"networkBaseTokenPriceDecimals","internalType":"uint8"}]}],"name":"getReservesData","inputs":[{"type":"address","name":"provider","internalType":"contract ILendingPoolAddressesProvider"}]},{"type":"function","stateMutability":"view","outputs":[{"type":"address[]","name":"","internalType":"address[]"}],"name":"getReservesList","inputs":[{"type":"address","name":"provider","internalType":"contract ILendingPoolAddressesProvider"}]},{"type":"function","stateMutability":"view","outputs":[{"type":"tuple[]","name":"","internalType":"struct IUiPoolDataProviderV2.UserReserveData[]","components":[{"type":"address","name":"underlyingAsset","internalType":"address"},{"type":"uint256","name":"scaledLTokenBalance","internalType":"uint256"},{"type":"bool","name":"usageAsCollateralEnabledOnUser","internalType":"bool"},{"type":"uint256","name":"stableBorrowRate","internalType":"uint256"},{"type":"uint256","name":"scaledVariableDebt","internalType":"uint256"},{"type":"uint256","name":"principalStableDebt","internalType":"uint256"},{"type":"uint256","name":"stableBorrowLastUpdateTimestamp","internalType":"uint256"}]}],"name":"getUserReservesData","inputs":[{"type":"address","name":"provider","internalType":"contract ILendingPoolAddressesProvider"},{"type":"address","name":"user","internalType":"address"}]},{"type":"function","stateMutability":"view","outputs":[{"type":"address","name":"","internalType":"contract IPriceAggregatorAdapter"}],"name":"networkBaseTokenPriceInUsdProxyAggregatorAdapter","inputs":[]}]

const iface = new ethers.utils.Interface(abi);

export class IUiPoolDataProvider {
    contract: ethers.Contract
    iface = iface
    constructor(provider: ethers.providers.JsonRpcProvider | ethers.Wallet | AcalaJsonRpcProvider) {
        this.contract = new ethers.Contract(
            "0xEcC925257315864Ba9f4B61D00A7b157C29c6B4C",
            abi,
            provider
        );
    }

    async getUserReservesData(userAddress: UserAddress) {
        return await this.contract.getUserReservesData("0x5AA0f1456dA50828F6eFb5B751F51a402bB25bBD", userAddress)
    }
}